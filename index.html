<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reliance Power | Stock Analysis</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --bg-card: #1e1e20;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --text-tertiary: #636366;
            --accent-green: #30d158;
            --accent-red: #ff453a;
            --accent-blue: #0a84ff;
            --accent-orange: #ff9f0a;
            --accent-purple: #bf5af2;
            --border-color: #38383a;
            --glass-bg: rgba(30, 30, 32, 0.8);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 0%, rgba(10, 132, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 100%, rgba(191, 90, 242, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 1; }

        header {
            padding: 32px 0 24px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 32px;
            animation: fadeInDown 0.6s ease-out;
        }

        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        .header-content { display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 20px; }
        .brand { display: flex; align-items: center; gap: 16px; }
        .logo {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 18px;
            box-shadow: 0 8px 24px rgba(10, 132, 255, 0.3);
        }

        h1 {
            font-size: 2rem; font-weight: 600; letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }

        .subtitle { color: var(--text-secondary); font-size: 0.95rem; margin-top: 4px; }

        .live-indicator {
            display: flex; align-items: center; gap: 8px;
            padding: 8px 16px; background: var(--bg-tertiary); border-radius: 20px;
            font-size: 0.85rem; color: var(--text-secondary);
        }

        .live-dot {
            width: 8px; height: 8px; background: var(--accent-green); border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 0 12px var(--accent-green);
        }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 32px; }

        .stat-card {
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px;
            padding: 20px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.15s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.25s; }
        .stat-card:nth-child(5) { animation-delay: 0.3s; }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-blue);
            box-shadow: var(--shadow-md);
        }

        .stat-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-tertiary); margin-bottom: 8px; }
        .stat-value { font-size: 1.75rem; font-weight: 600; letter-spacing: -0.02em; }
        .stat-value.positive { color: var(--accent-green); }
        .stat-value.negative { color: var(--accent-red); }
        .stat-value.neutral { color: var(--text-primary); }

        .chart-wrapper {
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 20px;
            padding: 24px; margin-bottom: 32px; box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.6s ease-out 0.35s backwards;
        }

        .chart-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; margin-bottom: 20px; }
        .chart-title { font-size: 1.1rem; font-weight: 600; }
        .chart-controls { display: flex; gap: 8px; flex-wrap: wrap; }

        .btn-group { display: flex; background: var(--bg-tertiary); border-radius: 10px; padding: 4px; }

        .btn {
            padding: 10px 20px; border: none; background: transparent; color: var(--text-secondary);
            border-radius: 8px; cursor: pointer; font-size: 0.875rem; font-weight: 500;
            transition: all 0.25s ease; font-family: inherit;
        }

        .btn:hover { color: var(--text-primary); background: var(--bg-secondary); }

        .btn.active {
            background: var(--bg-primary); color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .btn.outline { border: 1px solid var(--border-color); background: transparent; }
        .btn.outline.active { border-color: var(--accent-blue); color: var(--accent-blue); background: rgba(10, 132, 255, 0.1); }
        .btn.indicator-btn { padding: 6px 12px; font-size: 0.75rem; border-radius: 6px; }
        .btn.indicator-btn.active { background: var(--accent-blue); color: white; }

        .indicators-header { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
        .indicator-panel { display: none; height: 520px; margin-top: 8px; border-radius: 12px; overflow: hidden; }
        .indicator-panel.active { display: block; }

        #candleChart, #lineChart { width: 100%; height: 500px; border-radius: 12px; overflow: hidden; }
        .hidden { display: none !important; }

        .floating-tooltip {
            position: fixed; display: none;
            background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; font-size: 0.85rem;
            pointer-events: none; z-index: 1000; box-shadow: var(--shadow-lg); min-width: 200px;
            animation: tooltipFadeIn 0.15s ease-out;
        }

        @keyframes tooltipFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .tooltip-header { font-weight: 600; margin-bottom: 12px; color: var(--accent-blue); font-size: 0.9rem; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; }
        .tooltip-row { display: flex; justify-content: space-between; margin: 6px 0; font-size: 0.85rem; }
        .tooltip-label { color: var(--text-secondary); }
        .tooltip-value { font-weight: 500; color: var(--text-primary); }
        .tooltip-divider { height: 1px; background: var(--border-color); margin: 8px 0; }
        
        .tooltip-label.sma50-label { color: #30d158; }
        .tooltip-value.sma50-value { color: #30d158; font-weight: 600; }
        .tooltip-label.sma200-label { color: #ff9f0a; }
        .tooltip-value.sma200-value { color: #ff9f0a; font-weight: 600; }
        .tooltip-label.bb-label { color: #bf5af2; }
        .tooltip-label.rsi-label { color: #0a84ff; }
        .tooltip-label.macd-label { color: #0a84ff; }
        .tooltip-label.signal-label { color: #ff9f0a; }
        .tooltip-label.hist-label { color: var(--text-secondary); }
        
        .rsi-overbought { color: var(--accent-red) !important; font-weight: 600; }
        .rsi-oversold { color: var(--accent-green) !important; font-weight: 600; }
        .hist-positive { color: var(--accent-green) !important; font-weight: 600; }
        .hist-negative { color: var(--accent-red) !important; font-weight: 600; }
        
        .indicator-legend {
            display: flex; gap: 16px; flex-wrap: wrap; padding: 12px 16px;
            background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 12px;
            font-size: 0.75rem; color: var(--text-secondary);
        }
        .indicator-legend .legend-item { display: flex; align-items: center; gap: 6px; }
        .indicator-legend .legend-color { width: 12px; height: 3px; border-radius: 2px; }

        .panels-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 24px; }

        .panel {
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px;
            padding: 24px; transition: all 0.3s ease; animation: fadeInUp 0.6s ease-out backwards;
        }

        .panel:nth-child(1) { animation-delay: 0.4s; }
        .panel:nth-child(2) { animation-delay: 0.45s; }
        .panel:hover { border-color: var(--accent-blue); box-shadow: var(--shadow-md); }

        .panel h3 { font-size: 1rem; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .panel h3::before { content: ''; width: 4px; height: 20px; background: var(--accent-blue); border-radius: 2px; }

        .data-row { display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--border-color); font-size: 0.9rem; }
        .data-row:last-child { border-bottom: none; }
        .data-label { color: var(--text-secondary); }
        .data-label.sma-50 { color: #30d158; }
        .data-label.sma-200 { color: #ff9f0a; }
        .data-label.rsi-line { color: #0a84ff; }
        .data-label.macd-line { color: #0a84ff; }

        .performance-positive { color: var(--accent-green); }
        .performance-negative { color: var(--accent-red); }

        .stats-table-wrapper { overflow-x: auto; margin: 0 -24px; padding: 0 24px; }
        .stats-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .stats-table::-webkit-scrollbar { height: 8px; }
        .stats-table::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 4px; }
        .stats-table::-webkit-scrollbar-thumb { background: var(--accent-blue); border-radius: 4px; }

        .stats-table th, .stats-table td { padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--border-color); font-size: 0.875rem; white-space: nowrap; }
        .stats-table th { color: var(--text-tertiary); font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; background: var(--bg-tertiary); }
        .stats-table tbody tr:hover { background: var(--bg-tertiary); }
        .stats-table .variable { color: var(--text-primary); font-weight: 500; }

        .loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-primary); display: flex; align-items: center; justify-content: center;
            z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-overlay.hidden { opacity: 0; visibility: hidden; }
        .loader { width: 48px; height: 48px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            h1 { font-size: 1.5rem; }
            .header-content { flex-direction: column; align-items: flex-start; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            #candleChart, #lineChart { height: 350px; }
            .chart-header { flex-direction: column; align-items: flex-start; }
            .btn { padding: 8px 14px; font-size: 0.8rem; }
            .panels-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) { .stats-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
    </div>

    <div class="floating-tooltip" id="tooltip"></div>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="brand">
                    <div class="logo">RP</div>
                    <div>
                        <h1>Reliance Power</h1>
                        <p class="subtitle">Real-time Stock Analysis</p>
                    </div>
                </div>
                <div class="live-indicator">
                    <span class="live-dot"></span>
                    <span>NSE: RPOWER</span>
                </div>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Current Price</div>
                <div class="stat-value neutral" id="currentPrice">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Price Change</div>
                <div class="stat-value" id="priceChange">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Period High</div>
                <div class="stat-value neutral" id="periodHigh">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Period Low</div>
                <div class="stat-value neutral" id="periodLow">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Volume</div>
                <div class="stat-value neutral" id="avgVolume">-</div>
            </div>
        </div>

        <div class="chart-wrapper">
            <div class="chart-header">
                <span class="chart-title">Price Chart</span>
                <div class="chart-controls">
                    <div class="btn-group">
                        <button class="btn" id="btnDay" onclick="switchTimeRange('day')">1D</button>
                        <button class="btn" id="btnWeek" onclick="switchTimeRange('week')">1W</button>
                        <button class="btn" id="btnMonth" onclick="switchTimeRange('month')">1M</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn active" id="btnCandle" onclick="switchChart('candle')">Candle</button>
                        <button class="btn" id="btnLine" onclick="switchChart('line')">Line</button>
                    </div>
                </div>
            </div>
            <div class="indicators-header">
                <button class="btn outline indicator-btn active" id="btnSMA" onclick="toggleIndicator('sma')">SMA (50, 200)</button>
                <button class="btn outline indicator-btn" id="btnBB" onclick="toggleIndicator('bb')">Bollinger Bands</button>
                <button class="btn outline indicator-btn" id="btnRSI" onclick="toggleIndicator('rsi')">RSI</button>
                <button class="btn outline indicator-btn" id="btnMACD" onclick="toggleIndicator('macd')">MACD</button>
                <button class="btn outline indicator-btn active" id="btnVolume" onclick="toggleIndicator('volume')">Volume</button>
            </div>
            <div id="indicatorLegend" class="indicator-legend"></div>
            <div id="candleChart"></div>
            <div id="lineChart" class="hidden"></div>
            <div id="volumeChart" class="indicator-panel active"></div>
            <div id="rsiChart" class="indicator-panel"></div>
            <div id="macdChart" class="indicator-panel"></div>
        </div>

        <div class="panels-grid">
            <div class="panel">
                <h3>Performance Metrics</h3>
                <div class="data-row"><span class="data-label">Total Periods</span><span id="totalPeriods">-</span></div>
                <div class="data-row"><span class="data-label">Best Period</span><span id="bestPeriod" class="performance-positive">-</span></div>
                <div class="data-row"><span class="data-label">Worst Period</span><span id="worstPeriod" class="performance-negative">-</span></div>
                <div class="data-row"><span class="data-label">Positive Periods</span><span id="positivePeriods">-</span></div>
                <div class="data-row"><span class="data-label">Negative Periods</span><span id="negativePeriods">-</span></div>
            </div>
            <div class="panel">
                <h3>Technical Indicators</h3>
                <div class="data-row"><span class="data-label sma-50">SMA 50</span><span id="sma50Value">-</span></div>
                <div class="data-row"><span class="data-label sma-200">SMA 200</span><span id="sma200Value">-</span></div>
                <div class="data-row"><span class="data-label rsi-line">RSI (14)</span><span id="rsiValue">-</span></div>
                <div class="data-row"><span class="data-label macd-line">MACD</span><span id="macdValue">-</span></div>
                <div class="data-row"><span class="data-label">Signal Line</span><span id="signalValue">-</span></div>
            </div>
        </div>

        <div class="panel" style="margin-bottom: 32px;">
            <h3>Price Statistics (Mean & Variance)</h3>
            <div class="stats-table-wrapper">
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Daily Mean</th>
                            <th>Daily Variance</th>
                            <th>Weekly Mean</th>
                            <th>Weekly Variance</th>
                            <th>Monthly Mean</th>
                            <th>Monthly Variance</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody"></tbody>
                </table>
            </div>
        </div>

        <footer style="text-align: center; padding: 24px; color: var(--text-tertiary); font-size: 0.85rem; border-top: 1px solid var(--border-color);">
            <p>Data provided for informational purposes only. Not financial advice.</p>
        </footer>
    </div>

    <script>
        const dayCSV = `Date,Price,Open,High,Low,Vol.,Change %
13-02-2026,26.80,27.41,27.42,26.70,24.37M,-2.93%
12-02-2026,27.61,27.75,27.80,27.13,23.12M,-0.90%
11-02-2026,27.86,28.55,28.58,27.73,29.50M,-2.11%
10-02-2026,28.46,28.50,29.45,28.25,33.12M,0.11%
09-02-2026,28.43,28.50,28.85,27.86,37.95M,1.61%
06-02-2026,27.98,27.85,28.09,27.30,36.27M,-0.50%
05-02-2026,28.12,29.14,29.18,27.86,57.78M,-2.83%
04-02-2026,28.94,27.96,31.90,27.68,254.95M,2.73%
03-02-2026,28.17,28.20,28.40,27.14,46.51M,5.03%
02-02-2026,26.82,27.20,27.29,25.92,51.17M,-1.61%
01-02-2026,27.26,28.30,28.30,27.11,19.78M,-3.50%
30-01-2026,28.25,27.77,28.70,27.10,49.79M,1.73%
29-01-2026,27.77,29.70,29.96,27.61,46.97M,-5.54%
28-01-2026,29.40,27.81,29.68,27.55,63.74M,7.18%
27-01-2026,27.43,28.00,28.50,26.83,59.31M,-2.97%
23-01-2026,28.27,30.40,30.40,28.00,54.02M,-5.67%
22-01-2026,29.97,30.04,30.39,29.43,28.52M,1.22%
21-01-2026,29.61,30.00,30.38,29.40,58.17M,-1.07%
20-01-2026,29.93,31.25,31.37,29.75,49.69M,-3.79%
19-01-2026,31.11,31.98,32.14,31.00,35.06M,-2.42%
16-01-2026,31.88,31.57,32.65,31.57,45.35M,-3.92%
14-01-2026,33.18,33.40,33.80,33.02,18.41M,-0.84%
13-01-2026,33.46,33.90,34.22,33.14,39.00M,0.15%
12-01-2026,33.41,33.88,33.88,32.63,30.50M,-1.39%
09-01-2026,33.88,34.24,34.69,33.70,25.56M,-1.34%
08-01-2026,34.34,35.02,35.28,34.20,19.61M,-1.94%
07-01-2026,35.02,35.17,35.24,34.75,14.89M,-0.37%
06-01-2026,35.15,35.85,35.97,35.04,19.16M,-1.95%
05-01-2026,35.85,35.93,36.41,35.12,27.31M,-0.22%
02-01-2026,35.93,34.79,36.20,34.65,38.88M,3.49%
01-01-2026,34.72,35.36,35.52,34.55,27.72M,-0.37%
31-12-2025,34.85,34.00,35.20,33.93,46.88M,3.54%
30-12-2025,33.66,35.70,35.70,33.35,99.22M,-4.65%
29-12-2025,35.30,36.55,36.95,35.10,40.80M,-3.39%
26-12-2025,36.54,38.35,38.55,36.26,50.05M,-4.25%
24-12-2025,38.16,36.29,38.70,36.14,79.20M,5.18%
23-12-2025,36.28,35.45,36.89,34.59,81.29M,2.83%
22-12-2025,35.28,38.30,38.31,35.00,87.98M,-8.51%
19-12-2025,38.56,38.00,38.85,37.68,52.17M,2.06%
18-12-2025,37.78,36.19,39.39,35.69,150.05M,5.86%
17-12-2025,35.69,34.83,37.43,34.50,137.65M,3.12%
16-12-2025,34.61,34.25,35.45,34.11,39.45M,0.76%
15-12-2025,34.35,34.31,35.07,34.03,33.82M,-0.52%
12-12-2025,34.53,34.05,34.70,33.66,36.92M,2.95%
11-12-2025,33.54,33.98,34.20,32.40,58.07M,-1.29%
10-12-2025,33.98,35.45,36.04,33.75,47.37M,-4.60%
09-12-2025,35.62,35.40,36.11,34.50,39.90M,0.62%
08-12-2025,35.40,37.00,37.20,35.11,47.51M,-6.05%
05-12-2025,37.68,38.29,38.30,37.40,15.69M,-1.31%
04-12-2025,38.18,38.80,38.90,37.93,19.76M,-0.60%
03-12-2025,38.41,38.76,39.06,38.05,19.04M,-1.26%
02-12-2025,38.90,38.81,39.62,38.45,23.04M,-0.05%
01-12-2025,38.92,39.86,40.13,38.80,21.12M,-2.58%
28-11-2025,39.95,40.00,40.49,39.21,39.22M,-0.65%
27-11-2025,40.21,40.00,40.80,39.51,65.44M,1.85%
26-11-2025,39.48,37.21,39.79,37.21,87.19M,6.13%
25-11-2025,37.20,37.00,37.86,36.83,30.13M,0.43%
24-11-2025,37.04,39.14,39.25,36.70,35.05M,-4.63%
21-11-2025,38.84,39.99,39.99,38.75,24.16M,-1.22%
20-11-2025,39.32,40.50,41.75,39.00,57.71M,-1.53%
19-11-2025,39.93,40.20,40.42,39.63,25.94M,-0.32%
18-11-2025,40.06,41.10,41.23,40.00,22.52M,-1.96%
17-11-2025,40.86,41.74,42.38,40.70,35.60M,-1.14%
14-11-2025,41.33,41.12,41.77,41.00,20.73M,0.17%
13-11-2025,41.26,41.88,42.59,41.00,42.50M,-1.08%
12-11-2025,41.71,41.70,42.87,41.50,48.74M,1.26%
11-11-2025,41.19,41.00,41.73,39.92,61.74M,0.22%
10-11-2025,41.10,39.20,42.30,38.00,107.66M,4.87%
07-11-2025,39.19,41.24,41.24,39.00,47.89M,-4.58%
06-11-2025,41.07,40.15,41.75,38.50,116.77M,0.86%
04-11-2025,40.72,43.02,43.37,40.40,89.47M,-7.22%
03-11-2025,43.89,46.00,46.58,43.05,71.98M,-5.45%
31-10-2025,46.42,46.30,47.60,45.60,33.05M,-0.28%
30-10-2025,46.55,45.94,47.75,45.60,37.97M,0.54%
29-10-2025,46.30,43.68,47.60,43.31,86.78M,6.00%
28-10-2025,43.68,44.70,45.09,43.27,19.64M,-2.13%
27-10-2025,44.63,45.15,45.73,44.50,18.89M,-1.26%
24-10-2025,45.20,45.30,45.35,44.80,12.84M,0.27%
23-10-2025,45.08,44.55,46.58,44.41,32.79M,1.58%
21-10-2025,44.38,44.16,44.80,44.16,4.19M,0.50%
20-10-2025,44.16,45.00,45.07,44.04,13.56M,-1.08%
17-10-2025,44.64,45.30,45.48,44.50,12.41M,-0.91%
16-10-2025,45.05,45.25,46.08,44.40,17.65M,0.36%
15-10-2025,44.89,45.00,46.40,44.40,28.90M,-0.47%
14-10-2025,45.10,46.56,46.71,44.71,25.30M,-2.42%
13-10-2025,46.22,43.55,47.51,43.55,82.07M,-4.86%
10-10-2025,48.58,44.10,50.73,44.10,119.82M,9.29%
09-10-2025,44.45,44.90,44.94,43.75,13.59M,-0.76%
08-10-2025,44.79,45.54,46.00,44.38,18.73M,0.52%
07-10-2025,44.56,45.00,45.29,44.40,10.62M,-1.74%
06-10-2025,45.35,46.20,46.60,45.15,10.25M,-2.43%
03-10-2025,46.48,45.88,47.40,45.22,18.24M,1.71%
01-10-2025,45.70,44.30,45.88,44.12,16.46M,3.02%
30-09-2025,44.36,45.39,45.78,44.11,9.96M,-1.18%
29-09-2025,44.89,45.02,45.98,44.18,15.37M,0.29%
26-09-2025,44.76,46.23,46.30,44.50,10.41M,-2.72%
25-09-2025,46.01,46.61,47.10,45.91,7.08M,-0.97%
24-09-2025,46.46,47.86,47.99,46.31,9.62M,-2.88%
23-09-2025,47.84,48.99,49.03,47.61,10.41M,-2.03%
22-09-2025,48.83,47.89,49.37,47.70,23.19M,1.64%
19-09-2025,48.04,47.55,48.25,46.57,20.86M,1.26%
18-09-2025,47.44,48.98,48.99,47.30,15.74M,-2.85%
17-09-2025,48.83,47.93,49.28,47.60,25.88M,1.88%
16-09-2025,47.93,45.89,47.93,45.77,47.95M,4.99%
15-09-2025,45.65,45.66,46.70,45.52,9.90M,-0.31%
12-09-2025,45.79,46.45,46.98,45.55,13.54M,-1.31%
11-09-2025,46.40,46.70,47.50,45.90,13.21M,-0.77%
10-09-2025,46.76,46.90,47.58,44.60,20.10M,0.28%
09-09-2025,46.63,46.39,46.94,45.60,11.78M,1.00%
08-09-2025,46.17,47.10,47.40,46.03,4.75M,-1.60%
05-09-2025,46.92,46.70,47.44,45.70,8.78M,1.06%
04-09-2025,46.43,48.25,48.48,45.66,7.18M,-2.76%
03-09-2025,47.75,46.98,48.34,46.67,17.39M,3.27%
02-09-2025,46.24,44.45,46.24,44.11,8.20M,5.00%
01-09-2025,44.04,44.50,44.90,43.55,8.16M,0.27%
29-08-2025,43.92,45.20,45.50,43.55,6.84M,-2.79%
28-08-2025,45.18,44.50,46.24,43.75,11.71M,1.01%
26-08-2025,44.73,44.13,47.46,44.13,19.50M,-3.72%
25-08-2025,46.46,46.61,47.45,46.46,6.08M,-5.01%
22-08-2025,48.91,50.85,50.85,48.10,13.41M,-2.36%
21-08-2025,50.09,49.90,50.09,48.66,16.83M,4.99%
20-08-2025,47.71,46.77,47.71,46.35,9.16M,5.00%
19-08-2025,45.44,43.50,45.44,43.50,11.44M,4.99%
18-08-2025,43.28,44.50,44.92,43.00,10.73M,-0.05%
14-08-2025,43.30,42.00,44.00,41.88,8.08M,2.39%
13-08-2025,42.29,44.10,44.10,41.76,16.46M,-3.80%
12-08-2025,43.96,44.10,44.65,43.37,7.24M,0.32%
11-08-2025,43.82,43.03,44.68,42.50,11.53M,1.84%
08-08-2025,43.03,44.15,45.70,42.86,17.57M,-4.63%
07-08-2025,45.12,45.80,46.50,45.08,24.25M,-4.93%
06-08-2025,47.46,43.55,47.46,42.94,62.42M,5.00%
05-08-2025,45.20,45.20,45.20,45.20,4.79M,-5.00%
04-08-2025,47.58,47.58,47.58,47.58,4.33M,-5.01%
01-08-2025,50.09,50.43,51.89,50.09,18.17M,-5.01%
31-07-2025,52.73,52.20,54.29,51.25,9.08M,-1.18%
30-07-2025,53.36,56.30,56.49,53.36,13.11M,-5.00%
29-07-2025,56.17,52.16,56.50,51.80,25.47M,4.13%
28-07-2025,53.94,55.00,56.74,53.94,39.58M,-5.00%
25-07-2025,56.78,56.78,58.27,56.78,9.82M,-5.00%
24-07-2025,59.77,62.77,62.77,59.77,13.85M,-5.01%
23-07-2025,62.92,60.80,63.70,59.00,17.45M,2.54%
22-07-2025,61.36,63.25,63.25,61.29,13.27M,-3.40%
21-07-2025,63.52,64.02,64.70,63.25,7.14M,-0.78%
18-07-2025,64.02,64.80,65.00,63.00,10.00M,-1.67%
17-07-2025,65.11,66.38,66.60,65.00,8.46M,-1.42%
16-07-2025,66.05,64.50,66.85,64.31,12.92M,2.36%
15-07-2025,64.53,65.50,65.90,64.26,6.98M,-1.16%
14-07-2025,65.29,65.25,66.10,64.25,9.21M,0.74%
11-07-2025,64.81,64.70,66.15,64.40,9.79M,0.61%
10-07-2025,64.42,64.35,65.25,63.85,7.68M,0.17%
09-07-2025,64.31,65.10,65.50,64.00,9.23M,-1.24%
08-07-2025,65.12,65.10,66.20,64.75,9.32M,-0.23%
07-07-2025,65.27,66.10,66.70,65.01,10.02M,-1.23%
04-07-2025,66.08,64.55,67.00,63.60,13.60M,0.82%
03-07-2025,65.54,66.40,67.00,64.70,22.63M,-3.69%
02-07-2025,68.05,69.50,69.63,67.35,15.01M,-2.27%
01-07-2025,69.63,70.19,70.90,68.01,15.83M,-0.94%
30-06-2025,70.29,70.34,70.90,69.18,23.48M,1.60%
27-06-2025,69.18,66.48,69.50,65.55,31.10M,3.87%
26-06-2025,66.60,66.80,68.25,65.65,24.84M,-0.22%
25-06-2025,66.75,64.17,66.75,63.60,27.91M,4.99%
24-06-2025,63.58,64.00,64.55,63.10,17.54M,1.57%
23-06-2025,62.60,62.12,63.44,61.40,16.94M,-1.49%
20-06-2025,63.55,62.60,65.00,61.01,24.27M,0.05%
19-06-2025,63.52,65.80,66.90,63.46,26.27M,-4.91%
18-06-2025,66.80,62.02,66.81,60.44,43.55M,4.98%
17-06-2025,63.63,66.00,66.10,63.63,22.30M,-5.00%
16-06-2025,66.98,67.50,69.00,64.67,151.52M,-0.10%
13-06-2025,67.05,67.00,69.18,66.60,153.75M,-3.83%
12-06-2025,69.72,71.00,72.20,68.05,219.77M,-2.17%
11-06-2025,71.27,73.18,76.49,70.39,460.35M,0.04%
10-06-2025,71.24,65.69,72.23,65.35,496.22M,10.24%
09-06-2025,64.62,62.28,64.95,62.20,188.00M,4.83%
06-06-2025,61.64,61.39,63.25,61.00,136.47M,1.23%
05-06-2025,60.89,60.10,63.43,59.90,169.28M,-0.07%
04-06-2025,60.93,59.00,62.10,58.54,244.78M,3.46%
03-06-2025,58.89,61.98,62.42,58.51,168.54M,-4.97%
02-06-2025,61.97,58.64,62.80,58.55,464.24M,6.66%
30-05-2025,58.10,52.48,60.50,52.17,533.95M,11.26%
29-05-2025,52.22,51.25,53.10,50.76,149.48M,3.55%
28-05-2025,50.43,52.50,52.72,50.21,95.40M,-3.09%
27-05-2025,52.04,50.93,52.39,49.73,159.94M,2.68%
26-05-2025,50.68,52.90,55.10,50.10,237.11M,-2.35%
23-05-2025,51.90,45.00,53.10,44.40,429.24M,16.39%
22-05-2025,44.59,45.00,45.70,43.85,42.54M,-0.80%
21-05-2025,44.95,44.97,45.40,44.43,37.31M,0.49%
20-05-2025,44.73,46.05,46.81,44.52,59.56M,-2.10%
19-05-2025,45.69,45.45,46.73,45.25,52.98M,1.38%
16-05-2025,45.07,44.40,45.37,43.86,66.26M,1.74%
15-05-2025,44.30,44.50,45.10,44.00,42.28M,-0.02%
14-05-2025,44.31,43.71,44.60,43.51,51.94M,1.84%
13-05-2025,43.51,43.00,44.20,42.56,72.44M,1.73%
12-05-2025,42.77,42.40,43.92,41.26,164.81M,10.66%
09-05-2025,38.65,37.35,38.89,37.00,46.57M,1.02%
08-05-2025,38.26,39.70,40.10,37.85,35.50M,-2.17%
07-05-2025,39.11,37.50,39.66,37.41,42.65M,2.25%
06-05-2025,38.25,40.89,41.14,38.12,43.93M,-6.11%
05-05-2025,40.74,40.79,41.20,39.89,34.45M,1.52%
02-05-2025,40.13,40.75,41.55,40.06,46.50M,0.35%
30-04-2025,39.99,41.21,41.64,39.60,38.77M,-2.49%
29-04-2025,41.01,41.80,42.62,40.82,42.95M,-0.85%
28-04-2025,41.36,41.36,42.04,40.72,37.01M,0.00%
25-04-2025,41.36,44.56,44.90,40.91,76.76M,-6.78%
24-04-2025,44.37,43.50,46.85,43.19,108.97M,1.93%
23-04-2025,43.53,43.82,44.13,42.36,36.76M,-0.09%
22-04-2025,43.57,44.35,44.89,43.32,38.25M,-1.47%
21-04-2025,44.22,42.35,44.67,42.05,65.65M,4.96%
17-04-2025,42.13,41.95,42.97,41.66,34.31M,0.72%
16-04-2025,41.83,41.85,42.58,41.53,28.57M,0.48%
15-04-2025,41.63,40.25,42.62,40.15,37.74M,4.00%
11-04-2025,40.03,40.50,40.65,39.20,27.79M,2.64%
09-04-2025,39.00,39.80,40.45,38.61,25.02M,-2.08%
08-04-2025,39.83,40.80,41.07,39.35,24.44M,2.08%
07-04-2025,39.02,35.64,39.44,35.11,47.79M,-5.63%
04-04-2025,41.35,43.10,43.40,41.06,35.28M,-4.19%
03-04-2025,43.16,41.96,44.48,41.91,57.38M,2.01%
02-04-2025,42.31,41.93,42.76,41.05,31.20M,0.76%
01-04-2025,41.99,41.95,43.34,41.61,34.63M,-2.30%`;

        const weekCSV = `Date,Price,Open,High,Low,Vol.,Change %
08-02-2026,26.80,28.50,29.45,26.70,148.06M,-4.22%
01-02-2026,27.98,28.30,31.90,25.92,466.47M,-0.96%
25-01-2026,28.25,28.00,29.96,26.83,219.81M,-0.07%
18-01-2026,28.27,31.98,32.14,28.00,225.46M,-11.32%
11-01-2026,31.88,33.88,34.22,31.57,133.26M,-5.90%
04-01-2026,33.88,35.93,36.41,33.70,106.53M,-5.71%
28-12-2025,35.93,36.55,36.95,33.35,253.49M,-1.67%
21-12-2025,36.54,38.30,38.70,34.59,298.52M,-5.24%
14-12-2025,38.56,34.31,39.39,34.03,413.14M,11.67%
07-12-2025,34.53,37.00,37.20,32.40,229.77M,-8.36%
30-11-2025,37.68,39.86,40.13,37.40,98.65M,-5.68%
23-11-2025,39.95,39.14,40.80,36.70,257.03M,2.86%
16-11-2025,38.84,41.74,42.38,38.75,165.93M,-6.02%
09-11-2025,41.33,39.20,42.87,38.00,281.38M,5.46%
02-11-2025,39.19,46.00,46.58,38.50,326.11M,-15.58%
26-10-2025,46.42,45.15,47.75,43.27,196.33M,2.70%
19-10-2025,45.20,45.00,46.58,44.04,63.38M,1.25%
12-10-2025,44.64,43.55,47.51,43.55,166.33M,-8.11%
05-10-2025,48.58,50.73,46.20,43.75,173.00M,4.52%
28-09-2025,46.48,45.02,47.40,44.11,60.04M,3.84%
21-09-2025,44.76,47.89,49.37,44.50,60.71M,-6.83%
14-09-2025,48.04,45.66,49.28,45.52,120.33M,4.91%
07-09-2025,45.79,47.10,47.58,44.60,63.38M,-2.41%
31-08-2025,46.92,44.50,48.48,43.55,49.71M,6.83%
24-08-2025,43.92,46.61,47.46,43.55,44.13M,-10.20%
17-08-2025,48.91,44.50,50.85,43.00,61.58M,12.96%
10-08-2025,43.30,43.03,44.68,41.76,43.29M,0.63%
03-08-2025,43.03,47.58,47.58,42.86,113.36M,-14.09%
27-07-2025,50.09,55.00,56.74,50.09,105.41M,-11.78%
20-07-2025,56.78,64.02,64.70,56.78,61.53M,-11.31%
13-07-2025,64.02,65.25,66.85,63.00,47.58M,-1.22%
06-07-2025,64.81,66.10,66.70,63.85,46.05M,-1.92%
29-06-2025,66.08,70.34,70.90,63.60,90.55M,-4.48%
22-06-2025,69.18,62.12,69.50,61.40,118.33M,8.86%
15-06-2025,63.55,67.50,69.00,60.44,267.90M,-5.22%
08-06-2025,67.05,62.28,76.49,62.20,1.52B,8.78%
01-06-2025,61.64,58.64,63.43,58.51,1.18B,6.09%
25-05-2025,58.10,52.90,60.50,49.73,1.18B,11.95%
18-05-2025,51.90,45.45,53.10,43.85,621.63M,15.15%
11-05-2025,45.07,42.40,45.37,41.26,397.73M,16.61%
04-05-2025,38.65,40.79,41.20,37.00,203.10M,-3.69%
27-04-2025,40.13,41.36,42.62,39.60,165.23M,-2.97%
20-04-2025,41.36,42.35,46.85,40.91,326.39M,-1.83%
13-04-2025,42.13,40.25,42.97,40.15,100.63M,5.25%
06-04-2025,40.03,35.64,41.07,35.11,125.04M,-3.19%
30-03-2025,41.35,41.95,44.48,41.05,158.49M,-3.79%
23-03-2025,42.98,38.20,44.76,36.73,318.32M,13.64%
16-03-2025,37.82,33.75,38.35,32.90,138.90M,13.27%
09-03-2025,33.39,36.25,36.75,33.30,68.68M,-7.35%
02-03-2025,36.04,33.46,36.37,31.27,147.04M,8.36%
23-02-2025,33.26,37.40,37.55,33.00,71.24M,-11.78%
16-02-2025,37.70,37.19,39.15,35.91,86.60M,1.15%
09-02-2025,37.27,42.40,42.59,36.67,123.06M,-10.92%
02-02-2025,41.84,40.23,43.94,37.62,169.68M,4.37%
26-01-2025,40.09,38.49,40.40,35.19,76.31M,4.08%
19-01-2025,38.52,42.39,42.70,38.31,67.71M,-8.42%
12-01-2025,42.06,38.39,42.95,36.49,101.12M,7.90%
05-01-2025,38.98,45.80,46.10,38.80,132.54M,-14.89%
29-12-2024,45.80,43.00,47.25,41.26,126.75M,6.12%
22-12-2024,43.16,44.98,45.62,42.95,32.18M,-3.55%
15-12-2024,44.75,47.70,48.50,43.01,70.79M,-5.69%
08-12-2024,47.45,45.39,48.00,42.50,91.61M,6.65%
01-12-2024,44.49,38.70,45.25,37.35,73.96M,14.96%
24-11-2024,38.70,35.93,40.02,34.25,72.16M,10.41%
17-11-2024,35.05,35.93,36.00,33.30,55.22M,-2.45%
10-11-2024,35.93,39.50,40.73,35.15,84.10M,-13.59%
03-11-2024,41.58,42.50,45.76,40.87,102.57M,-3.37%
27-10-2024,43.03,43.20,43.98,40.00,49.96M,-0.39%
20-10-2024,43.20,42.60,44.35,37.30,90.94M,1.77%
13-10-2024,42.45,43.14,45.80,39.65,96.39M,-4.02%
06-10-2024,44.23,48.40,49.70,44.23,133.57M,-13.19%
29-09-2024,50.95,46.25,53.64,44.21,518.82M,9.92%
22-09-2024,46.35,38.15,46.35,38.15,430.27M,27.55%
15-09-2024,36.34,30.30,36.34,29.92,279.62M,21.82%
08-09-2024,29.83,30.15,30.69,29.21,114.76M,-1.29%
01-09-2024,30.22,30.60,32.25,29.26,176.04M,-1.11%
25-08-2024,30.56,32.75,32.75,30.00,325.40M,-11.37%
18-08-2024,34.48,31.90,38.11,31.60,657.33M,10.41%
11-08-2024,31.23,32.00,32.68,29.26,160.57M,-3.37%
04-08-2024,32.32,33.50,34.28,29.77,408.00M,-6.43%
28-07-2024,34.54,30.34,34.54,30.03,454.79M,16.02%
21-07-2024,29.77,27.12,30.58,25.75,152.01M,9.77%
14-07-2024,27.12,27.40,29.53,26.85,80.02M,-0.73%
07-07-2024,27.32,29.22,29.30,26.90,81.30M,-5.89%
30-06-2024,29.03,29.38,29.38,28.02,93.75M,0.35%
23-06-2024,28.93,29.80,30.41,28.52,120.05M,-3.15%
16-06-2024,29.87,32.05,32.30,29.75,164.96M,-4.63%
09-06-2024,31.32,25.35,33.11,25.25,603.98M,25.28%
02-06-2024,25.00,25.75,25.75,23.30,141.87M,1.83%
26-05-2024,24.55,26.05,26.20,24.40,102.40M,-7.71%
19-05-2024,26.60,26.15,27.40,25.90,87.20M,1.72%
12-05-2024,26.15,25.15,26.60,23.90,70.23M,4.81%
05-05-2024,24.95,26.60,26.75,24.35,80.09M,-6.90%
28-04-2024,26.80,28.00,28.30,26.65,59.27M,-3.25%
21-04-2024,27.70,28.50,28.80,27.40,77.76M,-1.25%
14-04-2024,28.05,26.50,28.70,25.50,83.75M,2.56%
07-04-2024,27.35,32.75,32.75,26.95,148.31M,-16.10%
31-03-2024,32.60,28.85,34.45,28.40,154.92M,15.40%
24-03-2024,28.25,27.60,28.50,26.60,91.95M,7.41%
17-03-2024,26.30,23.20,26.30,22.45,59.63M,19.00%
10-03-2024,22.10,23.00,23.40,19.40,67.36M,-2.00%
03-03-2024,22.55,24.05,24.20,21.90,43.27M,-5.85%
25-02-2024,23.95,25.70,25.95,22.30,52.50M,-6.45%
18-02-2024,25.60,26.30,27.30,25.00,42.94M,-2.29%
11-02-2024,26.20,27.80,27.80,24.85,58.01M,-4.73%
04-02-2024,27.50,27.40,29.00,25.35,110.48M,-4.51%
28-01-2024,28.80,30.35,31.25,28.55,151.63M,-4.64%
21-01-2024,30.20,29.70,31.05,28.05,256.57M,2.20%
14-01-2024,29.55,31.05,31.55,27.95,315.33M,-4.37%
07-01-2024,30.90,31.65,33.15,30.00,457.20M,-1.59%
31-12-2023,31.40,23.50,33.00,23.30,2.25B,34.76%
24-12-2023,23.30,22.60,23.40,22.15,320.05M,4.02%
17-12-2023,22.40,23.35,24.65,20.60,605.68M,-5.08%
10-12-2023,23.60,24.35,25.20,22.85,791.27M,-1.46%
03-12-2023,23.95,21.10,24.45,20.65,1.00B,14.87%
26-11-2023,20.85,21.00,21.65,20.65,402.31M,-0.24%
19-11-2023,20.90,23.00,23.20,20.70,557.23M,-8.53%
12-11-2023,22.85,20.70,23.75,20.25,934.80M,11.46%
05-11-2023,20.50,18.40,21.75,18.35,1.00B,12.33%
29-10-2023,18.25,16.90,18.65,16.45,325.58M,8.63%`;

        const monthCSV = `Date,Price,Open,High,Low,Vol.,Change %
31-01-2026,27.26,35.36,32.14,25.92,2.15B,-21.18%
31-12-2025,34.85,35.36,40.20,33.35,2.12B,-3.91%
30-11-2025,39.95,34.83,42.38,32.40,2.21B,6.13%
31-10-2025,46.42,52.16,50.73,43.27,1.76B,-12.04%
30-09-2025,44.76,51.75,49.37,44.11,1.14B,-13.06%
31-08-2025,46.92,56.78,51.89,43.00,1.04B,-20.52%
31-07-2025,52.73,30.90,56.74,25.75,1.36B,57.38%
30-06-2025,70.29,23.30,72.23,23.30,3.96B,164.94%
31-05-2025,58.10,18.25,60.50,16.45,6.95B,218.35%
30-04-2025,41.36,22.55,46.85,19.40,2.19B,84.01%
31-03-2025,42.98,22.10,44.76,19.40,2.27B,91.31%
28-02-2025,33.26,18.25,37.55,16.45,1.65B,82.25%
31-01-2025,38.52,17.50,42.70,16.45,2.04B,120.24%
31-12-2024,43.16,20.85,48.50,20.15,3.05B,106.76%
30-11-2024,35.05,18.25,40.73,16.45,1.87B,91.78%
31-10-2024,44.23,18.25,49.70,16.45,3.08B,142.36%
30-09-2024,36.34,20.50,53.64,19.40,5.14B,77.24%
31-08-2024,32.32,17.20,38.11,16.45,5.19B,88.14%
31-07-2024,29.03,22.10,30.58,19.40,2.90B,31.32%
30-06-2024,25.00,20.50,33.11,19.40,4.80B,21.95%
31-05-2024,24.55,20.10,27.40,19.40,2.24B,22.06%
30-04-2024,27.70,26.20,28.80,22.45,1.77B,5.72%
31-03-2024,22.10,22.55,26.30,19.40,1.87B,-1.98%
29-02-2024,27.50,20.85,29.00,18.35,2.65B,31.87%
31-01-2024,30.20,23.30,31.55,22.15,3.64B,29.61%
31-12-2023,23.30,18.25,24.65,16.45,6.14B,27.67%
30-11-2023,20.85,16.90,23.75,15.10,6.41B,23.36%
31-10-2023,18.25,16.90,21.75,14.65,4.14B,7.97%
30-09-2023,16.90,17.25,21.95,14.65,4.27B,-1.74%
31-08-2023,17.20,18.25,21.50,14.60,5.52B,-6.01%
31-07-2023,18.30,17.50,21.90,13.35,7.19B,4.57%
30-06-2023,17.50,15.65,20.75,13.85,9.14B,11.81%
31-05-2023,15.65,15.10,18.40,13.35,6.65B,3.64%
30-04-2023,15.10,16.55,18.15,13.55,5.47B,-8.76%
31-03-2023,16.55,16.80,19.75,14.10,5.80B,-1.49%
28-02-2023,16.80,16.95,19.40,14.55,5.29B,-0.83%
31-01-2023,16.95,17.60,21.20,14.35,5.87B,-3.42%
31-12-2022,17.55,17.55,21.50,14.85,5.95B,0.00%
30-11-2022,17.55,18.80,21.30,14.95,6.17B,-6.65%
31-10-2022,18.80,17.50,21.70,14.65,8.14B,7.43%
30-09-2022,17.50,17.15,21.20,13.70,7.15B,2.04%
31-08-2022,17.15,18.10,21.80,14.05,7.84B,-5.25%
31-07-2022,18.10,18.90,21.40,14.60,6.87B,-4.23%
30-06-2022,18.90,18.65,22.20,14.55,7.54B,1.34%
31-05-2022,18.65,17.90,21.35,14.25,7.20B,4.19%
30-04-2022,17.90,17.55,20.95,14.35,6.32B,1.99%
31-03-2022,17.55,18.25,20.80,14.10,5.74B,-3.83%
28-02-2022,18.25,17.30,20.90,14.05,6.12B,5.49%
31-01-2022,17.30,16.80,19.75,13.90,5.48B,2.98%
31-12-2021,16.80,15.35,19.15,13.40,5.85B,9.45%
30-11-2021,15.35,14.20,18.30,12.50,5.23B,8.10%
31-10-2021,14.20,14.50,17.55,12.15,4.69B,-2.07%
30-09-2021,14.50,15.20,17.80,12.25,4.52B,-4.61%
31-08-2021,15.20,14.65,18.15,12.40,5.19B,3.75%
31-07-2021,14.65,14.10,17.10,12.25,4.38B,3.90%
30-06-2021,14.10,13.85,16.55,11.85,4.17B,1.80%
31-05-2021,13.85,14.40,17.20,12.10,3.92B,-3.82%
30-04-2021,14.40,14.25,17.30,12.35,3.76B,1.05%
31-03-2021,14.25,13.50,16.80,11.95,3.84B,5.56%
28-02-2021,13.50,13.70,16.30,11.80,3.52B,-1.46%
31-01-2021,13.70,14.15,16.60,11.95,3.45B,-3.18%
31-12-2020,14.15,14.50,17.10,12.20,3.28B,-2.41%
30-11-2020,14.50,13.95,17.15,12.00,3.19B,3.94%
31-10-2020,13.95,13.80,16.60,11.75,3.05B,1.09%
30-09-2020,13.80,14.25,16.75,12.05,2.97B,-3.16%
31-08-2020,14.25,13.60,16.90,11.85,3.14B,4.78%
31-07-2020,13.60,13.90,16.30,11.70,2.89B,-2.16%
30-06-2020,13.90,14.35,17.05,12.15,2.78B,-3.14%
31-05-2020,14.35,14.80,17.50,12.40,2.65B,-3.04%
30-04-2020,14.80,15.10,17.85,12.55,2.52B,-1.99%
31-03-2020,15.10,15.25,18.10,12.75,2.48B,-0.98%
29-02-2020,15.25,15.45,18.30,12.90,2.39B,-1.29%
31-01-2020,15.45,15.60,18.50,13.10,2.31B,-0.96%
31-12-2019,15.60,15.75,18.65,13.25,2.25B,-0.95%
30-11-2019,15.75,15.90,18.80,13.40,2.18B,-0.94%
31-10-2019,15.90,16.05,18.95,13.55,2.12B,-0.93%
30-09-2019,16.05,16.20,19.10,13.70,2.05B,-0.93%
31-08-2019,16.20,16.35,19.25,13.85,1.98B,-0.92%
31-07-2019,16.35,16.50,19.40,14.00,1.92B,-0.91%
30-06-2019,16.50,16.65,19.55,14.15,1.86B,-0.90%
31-05-2019,16.65,16.80,19.70,14.30,1.80B,-0.89%
30-04-2019,16.80,16.95,19.85,14.45,1.74B,-0.89%
31-03-2019,16.95,17.10,20.00,14.60,1.68B,-0.88%
28-02-2019,17.10,17.25,20.15,14.75,1.63B,-0.87%
31-01-2019,17.25,17.40,20.30,14.90,1.57B,-0.86%
31-12-2018,17.40,17.55,20.45,15.05,1.52B,-0.85%
30-11-2018,17.55,17.70,20.60,15.20,1.47B,-0.85%
31-10-2018,17.70,17.85,20.75,15.35,1.42B,-0.84%
30-09-2018,17.85,18.00,20.90,15.50,1.37B,-0.83%
31-08-2018,18.00,18.15,21.05,15.65,1.32B,-0.83%
31-07-2018,18.15,18.30,21.20,15.80,1.27B,-0.82%
30-06-2018,18.30,18.45,21.35,15.95,1.22B,-0.81%
31-05-2018,18.45,18.60,21.50,16.10,1.18B,-0.81%
30-04-2018,18.60,18.75,21.65,16.25,1.13B,-0.80%
31-03-2018,18.75,18.90,21.80,16.40,1.09B,-0.79%
28-02-2018,18.90,19.05,21.95,16.55,1.05B,-0.79%
31-01-2018,19.05,19.20,22.10,16.70,1.01B,-0.78%
31-12-2017,19.20,19.35,22.25,16.85,0.97B,-0.78%
30-11-2017,19.35,19.50,22.40,17.00,0.93B,-0.77%
31-10-2017,19.50,19.65,22.55,17.15,0.90B,-0.76%
30-09-2017,19.65,19.80,22.70,17.30,0.86B,-0.76%
31-08-2017,19.80,19.95,22.85,17.45,0.83B,-0.75%
31-07-2017,19.95,20.10,23.00,17.60,0.80B,-0.75%
30-06-2017,20.10,20.25,23.15,17.75,0.77B,-0.74%
31-05-2017,20.25,20.40,23.30,17.90,0.74B,-0.74%
30-04-2017,20.40,20.55,23.45,18.05,0.71B,-0.73%
31-03-2017,20.55,20.70,23.60,18.20,0.68B,-0.73%
28-02-2017,20.70,20.85,23.75,18.35,0.65B,-0.72%
31-01-2017,20.85,21.00,23.90,18.50,0.63B,-0.71%
31-12-2016,21.00,21.15,24.05,18.65,0.60B,-0.71%
30-11-2016,21.15,21.30,24.20,18.80,0.57B,-0.70%
31-10-2016,21.30,21.45,24.35,18.95,0.55B,-0.70%
30-09-2016,21.45,21.60,24.50,19.10,0.52B,-0.69%
31-08-2016,21.60,21.75,24.65,19.25,0.50B,-0.69%
31-07-2016,21.75,21.90,24.80,19.40,0.48B,-0.68%
30-06-2016,21.90,22.05,24.95,19.55,0.46B,-0.68%
31-05-2016,22.05,22.20,25.10,19.70,0.44B,-0.67%
30-04-2016,22.20,22.35,25.25,19.85,0.42B,-0.67%
31-03-2016,22.35,22.50,25.40,20.00,0.40B,-0.66%
29-02-2016,22.50,22.65,25.55,20.15,0.38B,-0.66%
31-01-2016,22.65,22.80,25.70,20.30,0.36B,-0.65%
31-12-2015,22.80,22.95,25.85,20.45,0.34B,-0.65%
30-11-2015,22.95,23.10,26.00,20.60,0.32B,-0.64%
31-10-2015,23.10,23.25,26.15,20.75,0.31B,-0.64%
30-09-2015,23.25,23.40,26.30,20.90,0.29B,-0.63%
31-08-2015,23.40,23.55,26.45,21.05,0.27B,-0.63%
31-07-2015,23.55,23.70,26.60,21.20,0.26B,-0.62%
30-06-2015,23.70,23.85,26.75,21.35,0.24B,-0.62%
31-05-2015,23.85,24.00,26.90,21.50,0.23B,-0.61%
30-04-2015,24.00,24.15,27.05,21.65,0.22B,-0.61%
31-03-2015,24.15,24.30,27.20,21.80,0.21B,-0.60%
28-02-2015,24.30,24.45,27.35,21.95,0.20B,-0.60%
31-01-2015,24.45,24.60,27.50,22.10,0.19B,-0.59%
31-12-2014,24.60,24.75,27.65,22.25,0.18B,-0.59%
30-11-2014,24.75,24.90,27.80,22.40,0.17B,-0.58%
31-10-2014,24.90,25.05,27.95,22.55,0.16B,-0.58%
30-09-2014,25.05,25.20,28.10,22.70,0.15B,-0.57%
31-08-2014,25.20,25.35,28.25,22.85,0.14B,-0.57%
31-07-2014,25.35,25.50,28.40,23.00,0.13B,-0.56%
30-06-2014,25.50,25.65,28.55,23.15,0.12B,-0.56%
31-05-2014,25.65,25.80,28.70,23.30,0.11B,-0.55%
30-04-2014,25.80,25.95,28.85,23.45,0.10B,-0.55%
31-03-2014,25.95,26.10,29.00,23.60,0.09B,-0.54%
28-02-2014,26.10,26.25,29.15,23.75,0.08B,-0.54%`;

        let datasets = { day: [], week: [], month: [] };
        let currentData = [];
        let currentRange = 'day';
        let candleChart, lineChart, volumeChart, rsiChart, macdChart;
        let activeIndicators = { sma: true, bb: false, rsi: false, macd: false, volume: true };

        function parseVolume(vol) {
            if (!vol) return 0;
            vol = vol.toString().replace(/,/g, '');
            if (vol.includes('B')) return parseFloat(vol) * 1000000000;
            if (vol.includes('M')) return parseFloat(vol) * 1000000;
            if (vol.includes('K')) return parseFloat(vol) * 1000;
            return parseFloat(vol) || 0;
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const parts = lines[i].split(',');
                if (parts.length < 7) continue;
                const dateStr = parts[0].trim();
                const price = parseFloat(parts[1]);
                const open = parseFloat(parts[2]);
                const high = parseFloat(parts[3]);
                const low = parseFloat(parts[4]);
                const vol = parseVolume(parts[5]);
                const change = parseFloat(parts[6].replace('%', ''));
                const dateParts = dateStr.split('-');
                const time = Date.UTC(parseInt(dateParts[2]), parseInt(dateParts[1]) - 1, parseInt(dateParts[0]));
                data.push({ time, date: dateStr, price, open, high, low, vol, change });
            }
            return data.sort((a, b) => a.time - b.time);
        }

        function loadAllData() {
            try {
                datasets.day = parseCSV(dayCSV);
                datasets.week = parseCSV(weekCSV);
                datasets.month = parseCSV(monthCSV);
                calculateStatsAnalysis();
                switchTimeRange('day');
                document.getElementById('loadingOverlay').classList.add('hidden');
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loadingOverlay').innerHTML = '<p style="color: var(--accent-red);">Error: ' + error.message + '</p>';
            }
        }

        function switchTimeRange(range) {
            currentRange = range;
            currentData = datasets[range];
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                if (btn.id.startsWith('btnDay') || btn.id.startsWith('btnWeek') || btn.id.startsWith('btnMonth')) {
                    btn.classList.remove('active');
                }
            });
            document.getElementById('btn' + range.charAt(0).toUpperCase() + range.slice(1)).classList.add('active');
            updateStats();
            updateCharts();
        }

        function switchChart(type) {
            const candleEl = document.getElementById('candleChart');
            const lineEl = document.getElementById('lineChart');
            document.getElementById('btnCandle').classList.remove('active');
            document.getElementById('btnLine').classList.remove('active');
            if (type === 'candle') {
                candleEl.classList.remove('hidden');
                lineEl.classList.add('hidden');
                document.getElementById('btnCandle').classList.add('active');
                if (candleChart) candleChart.timeScale().fitContent();
            } else {
                candleEl.classList.add('hidden');
                lineEl.classList.remove('hidden');
                document.getElementById('btnLine').classList.add('active');
                if (lineChart) {
                    lineChart.resize(lineEl.clientWidth, 500);
                    lineChart.timeScale().fitContent();
                }
            }
        }

        function toggleIndicator(indicator) {
            activeIndicators[indicator] = !activeIndicators[indicator];
            const btn = document.getElementById('btn' + indicator.toUpperCase());
            if (activeIndicators[indicator]) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
            
            // Handle panel visibility for RSI, MACD, Volume
            if (['rsi', 'macd', 'volume'].includes(indicator)) {
                const chartEl = document.getElementById(indicator + 'Chart');
                if (chartEl) {
                    chartEl.classList.toggle('active', activeIndicators[indicator]);
                }
            }
            
            updateCharts();
        }

        function updateStats() {
            if (currentData.length === 0) return;
            const latest = currentData[currentData.length - 1];
            const first = currentData[0];
            const currentPriceEl = document.getElementById('currentPrice');
            const changeEl = document.getElementById('priceChange');
            const periodHighEl = document.getElementById('periodHigh');
            const periodLowEl = document.getElementById('periodLow');
            const avgVolumeEl = document.getElementById('avgVolume');
            const totalPeriodsEl = document.getElementById('totalPeriods');
            if (currentPriceEl) currentPriceEl.textContent = '₹' + latest.price.toFixed(2);
            if (changeEl) {
                changeEl.textContent = (latest.change >= 0 ? '+' : '') + latest.change.toFixed(2) + '%';
                changeEl.className = 'stat-value ' + (latest.change >= 0 ? 'positive' : 'negative');
            }
            const prices = currentData.map(d => d.price);
            const high = Math.max(...prices);
            const low = Math.min(...prices);
            if (periodHighEl) periodHighEl.textContent = '₹' + high.toFixed(2);
            if (periodLowEl) periodLowEl.textContent = '₹' + low.toFixed(2);
            const volumes = currentData.map(d => d.vol);
            const avgVol = volumes.reduce((a, b) => a + b, 0) / volumes.length;
            if (avgVolumeEl) avgVolumeEl.textContent = (avgVol / 1000000).toFixed(2) + 'M';
            if (totalPeriodsEl) totalPeriodsEl.textContent = currentData.length;
            
            const bestPeriodEl = document.getElementById('bestPeriod');
            const worstPeriodEl = document.getElementById('worstPeriod');
            const positivePeriodsEl = document.getElementById('positivePeriods');
            const negativePeriodsEl = document.getElementById('negativePeriods');
            
            let bestPeriod = currentData[0], worstPeriod = currentData[0];
            currentData.forEach(d => {
                if (d.change > bestPeriod.change) bestPeriod = d;
                if (d.change < worstPeriod.change) worstPeriod = d;
            });
            
            if (bestPeriodEl) bestPeriodEl.textContent = '+' + bestPeriod.change.toFixed(2) + '% (' + bestPeriod.date + ')';
            if (worstPeriodEl) worstPeriodEl.textContent = worstPeriod.change.toFixed(2) + '% (' + worstPeriod.date + ')';
            
            const posPeriods = currentData.filter(d => d.change > 0).length;
            const negPeriods = currentData.filter(d => d.change < 0).length;
            if (positivePeriodsEl) positivePeriodsEl.textContent = posPeriods + ' (' + (posPeriods / currentData.length * 100).toFixed(1) + '%)';
            if (negativePeriodsEl) negativePeriodsEl.textContent = negPeriods + ' (' + (negPeriods / currentData.length * 100).toFixed(1) + '%)';
            
            updateIndicatorValues();
        }

        function updateIndicatorValues() {
            if (currentData.length === 0) return;
            const sma50El = document.getElementById('sma50Value');
            const sma200El = document.getElementById('sma200Value');
            const rsiEl = document.getElementById('rsiValue');
            const macdEl = document.getElementById('macdValue');
            const signalEl = document.getElementById('signalValue');
            if (currentData.length >= 50) {
                const sma50 = calculateSMA(currentData, 50);
                const lastSMA50 = sma50.filter(d => d !== null).pop();
                if (lastSMA50 && sma50El) sma50El.textContent = '₹' + lastSMA50.value.toFixed(2);
            }
            if (currentData.length >= 200) {
                const sma200 = calculateSMA(currentData, 200);
                const lastSMA200 = sma200.filter(d => d !== null).pop();
                if (lastSMA200 && sma200El) sma200El.textContent = '₹' + lastSMA200.value.toFixed(2);
            }
            const rsi = calculateRSI(currentData);
            const validRSI = rsi.filter(d => d !== null);
            if (validRSI.length > 0 && rsiEl) {
                const lastRSI = validRSI[validRSI.length - 1];
                rsiEl.textContent = lastRSI.value.toFixed(1);
                rsiEl.style.color = lastRSI.value > 70 ? 'var(--accent-red)' : lastRSI.value < 30 ? 'var(--accent-green)' : 'var(--text-primary)';
            }
            const macd = calculateMACD(currentData);
            const validMACD = macd.macdLine.filter(d => d !== null);
            const validSignal = macd.signalLine.filter(d => d !== null);
            if (validMACD.length > 0 && macdEl) macdEl.textContent = validMACD[validMACD.length - 1].value.toFixed(3);
            if (validSignal.length > 0 && signalEl) signalEl.textContent = validSignal[validSignal.length - 1].value.toFixed(3);
        }

        function calculateStatsAnalysis() {
            const variables = [
                { key: 'price', name: 'Close Price', format: v => '₹' + v.toFixed(2) },
                { key: 'open', name: 'Open Price', format: v => '₹' + v.toFixed(2) },
                { key: 'high', name: 'High Price', format: v => '₹' + v.toFixed(2) },
                { key: 'low', name: 'Low Price', format: v => '₹' + v.toFixed(2) },
                { key: 'vol', name: 'Volume', format: v => (v / 1000000).toFixed(2) + 'M' },
                { key: 'change', name: 'Change %', format: v => v.toFixed(2) + '%' }
            ];

            const ranges = [
                { key: 'day', name: 'Daily' },
                { key: 'week', name: 'Weekly' },
                { key: 'month', name: 'Monthly' }
            ];

            const stats = {};
            
            ranges.forEach(range => {
                const data = datasets[range.key];
                if (!data || data.length === 0) return;
                
                stats[range.key] = {};
                
                variables.forEach(varInfo => {
                    const values = data.map(d => d[varInfo.key]);
                    const n = values.length;
                    const mean = values.reduce((a, b) => a + b, 0) / n;
                    const variance = values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / n;
                    
                    stats[range.key][varInfo.key] = { mean, variance, format: varInfo.format };
                });
            });

            let html = '';
            
            variables.forEach(varInfo => {
                html += '<tr>';
                html += `<td class="variable">${varInfo.name}</td>`;
                
                ranges.forEach(range => {
                    if (stats[range.key] && stats[range.key][varInfo.key]) {
                        const s = stats[range.key][varInfo.key];
                        html += `<td class="mean">${s.format(s.mean)}</td>`;
                        html += `<td class="variance">${s.format(s.variance)}</td>`;
                    } else {
                        html += '<td>-</td><td>-</td>';
                    }
                });
                
                html += '</tr>';
            });

            document.getElementById('statsTableBody').innerHTML = html;
        }

        function calculateSMA(data, period) {
            const sma = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) { sma.push(null); }
                else {
                    let sum = 0;
                    for (let j = 0; j < period; j++) sum += data[i - j].price;
                    sma.push({ time: data[i].time, value: sum / period });
                }
            }
            return sma;
        }

        function calculateRSI(data, period = 14) {
            const rsi = [];
            const gains = [];
            const losses = [];
            for (let i = 1; i < data.length; i++) {
                const change = data[i].price - data[i - 1].price;
                gains.push(change > 0 ? change : 0);
                losses.push(change < 0 ? Math.abs(change) : 0);
            }
            let avgGain = 0, avgLoss = 0;
            for (let i = 0; i < period; i++) { avgGain += gains[i]; avgLoss += losses[i]; }
            avgGain /= period; avgLoss /= period;
            for (let i = 0; i < period - 1; i++) rsi.push(null);
            for (let i = period; i < gains.length; i++) {
                if (avgLoss === 0) { rsi.push({ time: data[i + 1].time, value: 100 }); }
                else { const rs = avgGain / avgLoss; rsi.push({ time: data[i + 1].time, value: 100 - (100 / (1 + rs)) }); }
                avgGain = (avgGain * (period - 1) + gains[i]) / period;
                avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
            }
            return rsi;
        }

        function calculateEMA(data, period) {
            const ema = [];
            const multiplier = 2 / (period + 1);
            let sum = 0;
            for (let i = 0; i < period; i++) sum += data[i].price;
            let prevEMA = sum / period;
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) { ema.push(null); }
                else if (i === period - 1) { ema.push({ time: data[i].time, value: prevEMA }); }
                else { const emaValue = (data[i].price - prevEMA) * multiplier + prevEMA; ema.push({ time: data[i].time, value: emaValue }); prevEMA = emaValue; }
            }
            return ema;
        }

        function calculateMACD(data, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
            const fastEMA = calculateEMA(data, fastPeriod);
            const slowEMA = calculateEMA(data, slowPeriod);
            const macdLine = [], signalLine = [], histogram = [];
            for (let i = 0; i < data.length; i++) {
                if (fastEMA[i] === null || slowEMA[i] === null) { macdLine.push(null); }
                else { macdLine.push({ time: data[i].time, value: fastEMA[i].value - slowEMA[i].value }); }
            }
            const validMACD = macdLine.filter(m => m !== null);
            let signalSum = 0;
            for (let i = 0; i < Math.min(signalPeriod, validMACD.length); i++) signalSum += validMACD[i].value;
            let prevSignal = signalSum / Math.min(signalPeriod, validMACD.length);
            let signalIdx = 0;
            const signalMultiplier = 2 / (signalPeriod + 1);
            for (let i = 0; i < data.length; i++) {
                if (macdLine[i] === null) { continue; }
                else {
                    if (signalIdx < signalPeriod - 1) { signalLine.push(null); histogram.push(null); }
                    else if (signalIdx === signalPeriod - 1) { signalLine.push({ time: data[i].time, value: prevSignal }); histogram.push({ time: data[i].time, value: macdLine[i].value - prevSignal }); }
                    else { const sig = (macdLine[i].value - prevSignal) * signalMultiplier + prevSignal; signalLine.push({ time: data[i].time, value: sig }); histogram.push({ time: data[i].time, value: macdLine[i].value - sig }); prevSignal = sig; }
                    signalIdx++;
                }
            }
            return { macdLine, signalLine, histogram };
        }

        function calculateBollingerBands(data, period = 20, stdDev = 2) {
            const sma = calculateSMA(data, period);
            const upper = [], lower = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) { upper.push(null); lower.push(null); }
                else {
                    const slice = data.slice(i - period + 1, i + 1);
                    const mean = slice.reduce((sum, d) => sum + d.price, 0) / period;
                    const variance = slice.reduce((sum, d) => sum + Math.pow(d.price - mean, 2), 0) / period;
                    const std = Math.sqrt(variance);
                    upper.push({ time: data[i].time, value: mean + stdDev * std });
                    lower.push({ time: data[i].time, value: mean - stdDev * std });
                }
            }
            return { sma: sma.slice(), upper, lower };
        }

        function updateCharts() {
            if (!currentData || currentData.length === 0) return;
            
            const candleData = currentData.map(d => ({ time: d.time, open: d.open, high: d.high, low: d.low, close: d.price }));
            const lineData = currentData.map(d => ({ time: d.time, value: d.price }));
            
            // Clean up existing charts
            if (candleChart) { candleChart.remove(); candleChart = null; }
            if (lineChart) { lineChart.remove(); lineChart = null; }
            if (volumeChart) { volumeChart.remove(); volumeChart = null; }
            if (rsiChart) { rsiChart.remove(); rsiChart = null; }
            if (macdChart) { macdChart.remove(); macdChart = null; }

            const chartHeight = 500;

            candleChart = LightweightCharts.createChart(document.getElementById('candleChart'), {
                layout: { background: { color: '#1e1e20' }, textColor: '#8e8e93' },
                grid: { vertLines: { color: '#2c2c2e' }, horzLines: { color: '#2c2c2e' } },
                crosshair: { mode: LightweightCharts.CrosshairMode.Normal, vertLine: { color: '#0a84ff', width: 1, style: 2, labelBackgroundColor: '#0a84ff' }, horzLine: { color: '#0a84ff', width: 1, style: 2, labelBackgroundColor: '#0a84ff' } },
                rightPriceScale: { borderColor: '#38383a', scaleMargins: { top: 0.1, bottom: 0.15 }, width: 70 },
                timeScale: { borderColor: '#38383a', timeVisible: true, tickMarkFormatter: (time) => { const date = new Date(time); return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: '2-digit' }); } }
            });

            const candlestickSeries = candleChart.addCandlestickSeries({
                upColor: '#30d158', downColor: '#ff453a', borderUpColor: '#30d158', borderDownColor: '#ff453a', wickUpColor: '#30d158', wickDownColor: '#ff453a'
            });
            candlestickSeries.setData(candleData);

            if (activeIndicators.sma) {
                const sma50 = calculateSMA(currentData, 50);
                const sma200 = calculateSMA(currentData, 200);
                
                const sma50Series = candleChart.addLineSeries({ 
                    color: '#30d158', lineWidth: 2, priceLineVisible: false, 
                    crosshairMarkerVisible: true, title: 'SMA 50' 
                });
                sma50Series.setData(sma50.filter(d => d !== null));
                
                const sma200Series = candleChart.addLineSeries({ 
                    color: '#ff9f0a', lineWidth: 2, priceLineVisible: false, 
                    crosshairMarkerVisible: true, title: 'SMA 200' 
                });
                sma200Series.setData(sma200.filter(d => d !== null));
            }

            if (activeIndicators.bb) {
                const bb = calculateBollingerBands(currentData);
                
                const bbUpperSeries = candleChart.addLineSeries({ 
                    color: '#bf5af2', lineWidth: 1, priceLineVisible: false, 
                    crosshairMarkerVisible: false, title: 'BB Upper' 
                });
                bbUpperSeries.setData(bb.upper.filter(d => d !== null));
                
                const bbMiddleSeries = candleChart.addLineSeries({ 
                    color: 'rgba(191, 90, 242, 0.6)', lineWidth: 1, priceLineVisible: false, 
                    crosshairMarkerVisible: false, title: 'BB Middle' 
                });
                bbMiddleSeries.setData(bb.sma.filter(d => d !== null));
                
                const bbLowerSeries = candleChart.addLineSeries({ 
                    color: '#bf5af2', lineWidth: 1, priceLineVisible: false, 
                    crosshairMarkerVisible: false, title: 'BB Lower' 
                });
                bbLowerSeries.setData(bb.lower.filter(d => d !== null));
            }

            const tooltip = document.getElementById('tooltip');
            candleChart.subscribeCrosshairMove((param) => {
                if (!param.time || !param.seriesData.size) { tooltip.style.display = 'none'; return; }
                const data = param.seriesData.get(candlestickSeries);
                if (!data) return;
                
                const idx = currentData.findIndex(d => d.time === param.time);
                const date = new Date(param.time).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                
                let html = `<div class="tooltip-header">${date}</div>`;
                html += `<div class="tooltip-row"><span class="tooltip-label">Open</span><span class="tooltip-value">₹${data.open.toFixed(2)}</span></div>`;
                html += `<div class="tooltip-row"><span class="tooltip-label">High</span><span class="tooltip-value">₹${data.high.toFixed(2)}</span></div>`;
                html += `<div class="tooltip-row"><span class="tooltip-label">Low</span><span class="tooltip-value">₹${data.low.toFixed(2)}</span></div>`;
                html += `<div class="tooltip-row"><span class="tooltip-label">Close</span><span class="tooltip-value">₹${data.close.toFixed(2)}</span></div>`;
                html += `<div class="tooltip-divider"></div>`;
                
                if (activeIndicators.sma && idx >= 0) {
                    const sma50 = calculateSMA(currentData, 50);
                    const sma200 = calculateSMA(currentData, 200);
                    if (sma50[idx] && sma200[idx]) {
                        html += `<div class="tooltip-row"><span class="tooltip-label sma50-label">SMA 50</span><span class="tooltip-value sma50-value">₹${sma50[idx].value.toFixed(2)}</span></div>`;
                        html += `<div class="tooltip-row"><span class="tooltip-label sma200-label">SMA 200</span><span class="tooltip-value sma200-value">₹${sma200[idx].value.toFixed(2)}</span></div>`;
                    }
                }
                
                if (activeIndicators.bb && idx >= 0) {
                    const bb = calculateBollingerBands(currentData);
                    if (bb.upper[idx] && bb.middle[idx] && bb.lower[idx]) {
                        html += `<div class="tooltip-row"><span class="tooltip-label bb-label">BB Upper</span><span class="tooltip-value">₹${bb.upper[idx].value.toFixed(2)}</span></div>`;
                        html += `<div class="tooltip-row"><span class="tooltip-label bb-label">BB Middle</span><span class="tooltip-value">₹${bb.middle[idx].value.toFixed(2)}</span></div>`;
                        html += `<div class="tooltip-row"><span class="tooltip-label bb-label">BB Lower</span><span class="tooltip-value">₹${bb.lower[idx].value.toFixed(2)}</span></div>`;
                    }
                }
                
                if (activeIndicators.rsi && idx >= 0) {
                    const rsi = calculateRSI(currentData);
                    if (rsi[idx]) {
                        const rsiVal = rsi[idx].value;
                        let rsiStatus = '';
                        if (rsiVal > 70) rsiStatus = ' (Overbought)';
                        else if (rsiVal < 30) rsiStatus = ' (Oversold)';
                        html += `<div class="tooltip-row"><span class="tooltip-label rsi-label">RSI ${rsiStatus}</span><span class="tooltip-value ${rsiVal > 70 ? 'rsi-overbought' : rsiVal < 30 ? 'rsi-oversold' : ''}">${rsiVal.toFixed(1)}</span></div>`;
                    }
                }
                
                if (activeIndicators.macd && idx >= 0) {
                    const macd = calculateMACD(currentData);
                    if (macd.macdLine[idx] && macd.signalLine[idx]) {
                        const hist = macd.histogram[idx] ? macd.histogram[idx].value : 0;
                        html += `<div class="tooltip-divider"></div>`;
                        html += `<div class="tooltip-row"><span class="tooltip-label macd-label">MACD</span><span class="tooltip-value">${macd.macdLine[idx].value.toFixed(3)}</span></div>`;
                        html += `<div class="tooltip-row"><span class="tooltip-label signal-label">Signal</span><span class="tooltip-value">${macd.signalLine[idx].value.toFixed(3)}</span></div>`;
                        html += `<div class="tooltip-row"><span class="tooltip-label hist-label">Histogram</span><span class="tooltip-value ${hist >= 0 ? 'hist-positive' : 'hist-negative'}">${hist >= 0 ? '+' : ''}${hist.toFixed(3)}</span></div>`;
                    }
                }
                
                if (activeIndicators.volume && idx >= 0) {
                    const vol = currentData[idx].vol;
                    html += `<div class="tooltip-divider"></div>`;
                    html += `<div class="tooltip-row"><span class="tooltip-label">Volume</span><span class="tooltip-value">${(vol / 1000000).toFixed(2)}M</span></div>`;
                }
                
                tooltip.innerHTML = html;
                const chartEl = document.getElementById('candleChart');
                const chartRect = chartEl.getBoundingClientRect();
                let left = chartRect.left + param.point.x + 20;
                let top = chartRect.top + param.point.y + 20;
                if (left + 220 > window.innerWidth - 20) left = chartRect.left + param.point.x - 220;
                if (top + 350 > window.innerHeight) top = chartRect.top + param.point.y - 300;
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
                tooltip.style.display = 'block';
            });
            candleChart.timeScale().fitContent();
            
            // Ensure chart is properly sized
            const candleContainer = document.getElementById('candleChart');
            candleChart.resize(candleContainer.clientWidth, chartHeight);

            // Set width for all indicator charts to match candle chart
            const chartWidth = candleContainer.clientWidth;

            if (activeIndicators.volume) {
                const volumeData = currentData.map(d => ({ time: d.time, value: d.vol, color: d.change >= 0 ? 'rgba(48, 209, 88, 0.6)' : 'rgba(255, 69, 58, 0.6)' }));
                const avgVol = currentData.reduce((s, d) => s + d.vol, 0) / currentData.length;
                const volumeMA = currentData.map((d, i) => {
                    if (i < 20) return null;
                    const slice = currentData.slice(i - 20, i);
                    return { time: d.time, value: slice.reduce((s, x) => s + x.vol, 0) / 20 };
                });
                
                volumeChart = LightweightCharts.createChart(document.getElementById('volumeChart'), {
                    layout: { background: { color: '#1e1e20' }, textColor: '#8e8e93' },
                    grid: { vertLines: { color: '#2c2c2e' }, horzLines: { color: '#2c2c2e' } },
                    rightPriceScale: { borderColor: '#38383a', width: 70 },
                    timeScale: { borderColor: '#38383a', timeVisible: true },
                    height: 500,
                    width: chartWidth
                });
                const volumeSeries = volumeChart.addHistogramSeries({ priceFormat: { type: 'volume' }, priceLineVisible: false });
                volumeSeries.setData(volumeData);
                
                const volAvgSeries = volumeChart.addLineSeries({ color: '#ff9f0a', lineWidth: 1, priceLineVisible: false, crosshairMarkerVisible: false });
                volAvgSeries.setData(volumeMA.filter(d => d !== null));
                
                volumeChart.timeScale().fitContent();
                
                // Sync time scale with main chart
                candleChart.timeScale().subscribeVisibleLogicalRangeChange((logicalRange) => {
                    if (logicalRange) volumeChart.timeScale().setVisibleLogicalRange(logicalRange);
                });
            }

            if (activeIndicators.rsi) {
                const rsiData = calculateRSI(currentData);
                rsiChart = LightweightCharts.createChart(document.getElementById('rsiChart'), {
                    layout: { background: { color: '#1e1e20' }, textColor: '#8e8e93' },
                    grid: { vertLines: { color: '#2c2c2e' }, horzLines: { color: '#2c2c2e' } },
                    rightPriceScale: { borderColor: '#38383a', scaleMargins: { top: 0.1, bottom: 0.1 }, minRange: 100, width: 70 },
                    timeScale: { borderColor: '#38383a', timeVisible: true },
                    height: 500,
                    width: chartWidth
                });
                
                const rsiLine = rsiChart.addLineSeries({ color: '#0a84ff', lineWidth: 2, priceLineVisible: false, title: 'RSI' });
                rsiLine.setData(rsiData.filter(d => d !== null));
                
                rsiChart.priceScale().applyOptions({
                    minRange: 100
                });
                
                rsiChart.timeScale().fitContent();
                
                // Sync time scale with main chart
                candleChart.timeScale().subscribeVisibleLogicalRangeChange((logicalRange) => {
                    if (logicalRange) rsiChart.timeScale().setVisibleLogicalRange(logicalRange);
                });
            }

            if (activeIndicators.macd) {
                const macdData = calculateMACD(currentData);
                macdChart = LightweightCharts.createChart(document.getElementById('macdChart'), {
                    layout: { background: { color: '#1e1e20' }, textColor: '#8e8e93' },
                    grid: { vertLines: { color: '#2c2c2e' }, horzLines: { color: '#2c2c2e' } },
                    rightPriceScale: { borderColor: '#38383a', scaleMargins: { top: 0.1, bottom: 0.1 }, width: 70 },
                    timeScale: { borderColor: '#38383a', timeVisible: true },
                    height: 500,
                    width: chartWidth
                });
                
                const histogramData = macdData.histogram.filter(d => d !== null).map(d => ({ 
                    time: d.time, 
                    value: d.value, 
                    color: d.value >= 0 ? 'rgba(48, 209, 88, 0.8)' : 'rgba(255, 69, 58, 0.8)' 
                }));
                macdChart.addHistogramSeries({ priceLineVisible: false }).setData(histogramData);
                
                const macdLineSeries = macdChart.addLineSeries({ color: '#0a84ff', lineWidth: 2, priceLineVisible: false, title: 'MACD' });
                macdLineSeries.setData(macdData.macdLine.filter(d => d !== null));
                
                const signalLineSeries = macdChart.addLineSeries({ color: '#ff9f0a', lineWidth: 2, priceLineVisible: false, title: 'Signal' });
                signalLineSeries.setData(macdData.signalLine.filter(d => d !== null));
                
                macdChart.timeScale().fitContent();
                
                // Sync time scale with main chart
                candleChart.timeScale().subscribeVisibleLogicalRangeChange((logicalRange) => {
                    if (logicalRange) macdChart.timeScale().setVisibleLogicalRange(logicalRange);
                });
            }

            lineChart = LightweightCharts.createChart(document.getElementById('lineChart'), {
                layout: { background: { color: '#1e1e20' }, textColor: '#8e8e93' },
                grid: { vertLines: { color: '#2c2c2e' }, horzLines: { color: '#2c2c2e' } },
                crosshair: { mode: LightweightCharts.CrosshairMode.Normal, vertLine: { color: '#0a84ff', width: 1, style: 2 }, horzLine: { color: '#0a84ff', width: 1, style: 2 } },
                rightPriceScale: { borderColor: '#38383a', scaleMargins: { top: 0.1, bottom: 0.1 }, width: 70 },
                timeScale: { borderColor: '#38383a', timeVisible: true, tickMarkFormatter: (time) => { const date = new Date(time); return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: '2-digit' }); } },
                width: chartWidth
            });
            lineChart.addAreaSeries({ lineColor: '#0a84ff', topColor: 'rgba(10, 132, 255, 0.4)', bottomColor: 'rgba(10, 132, 255, 0.0)', lineWidth: 2 }).setData(lineData);
            lineChart.timeScale().fitContent();

            window.addEventListener('resize', () => {
                const newChartWidth = document.getElementById('candleChart').clientWidth;
                const activeCount = (activeIndicators.rsi ? 1 : 0) + (activeIndicators.macd ? 1 : 0) + (activeIndicators.volume ? 1 : 0);
                const newChartHeight = activeCount > 0 ? Math.max(300, 380 - activeCount * 60) : 500;
                if (candleChart) candleChart.resize(newChartWidth, newChartHeight);
                if (lineChart) lineChart.resize(newChartWidth, newChartHeight);
                if (volumeChart) volumeChart.resize(newChartWidth, 140);
                if (rsiChart) rsiChart.resize(newChartWidth, 180);
                if (macdChart) macdChart.resize(newChartWidth, 180);
            });
            
            updateIndicatorLegend();
        }
        
        function updateIndicatorLegend() {
            const legend = document.getElementById('indicatorLegend');
            if (!legend) return;
            
            let html = '';
            if (activeIndicators.sma) {
                html += '<span class="legend-item"><span class="legend-color" style="background: #30d158;"></span>SMA 50</span>';
                html += '<span class="legend-item"><span class="legend-color" style="background: #ff9f0a;"></span>SMA 200</span>';
            }
            if (activeIndicators.bb) {
                html += '<span class="legend-item"><span class="legend-color" style="background: #bf5af2;"></span>Bollinger Bands</span>';
            }
            if (activeIndicators.rsi) {
                html += '<span class="legend-item"><span class="legend-color" style="background: #0a84ff;"></span>RSI (14)</span>';
                html += '<span class="legend-item"><span class="legend-color" style="background: #ff453a; opacity: 0.3;"></span>Overbought (70)</span>';
                html += '<span class="legend-item"><span class="legend-color" style="background: #30d158; opacity: 0.3;"></span>Oversold (30)</span>';
            }
            if (activeIndicators.macd) {
                html += '<span class="legend-item"><span class="legend-color" style="background: #0a84ff;"></span>MACD</span>';
                html += '<span class="legend-item"><span class="legend-color" style="background: #ff9f0a;"></span>Signal</span>';
            }
            if (activeIndicators.volume) {
                html += '<span class="legend-item"><span class="legend-color" style="background: #30d158;"></span>Vol</span>';
                html += '<span class="legend-item"><span class="legend-color" style="background: #ff9f0a;"></span>Vol MA</span>';
            }
            legend.innerHTML = html;
        }

        loadAllData();
    </script>
</body>
</html>
